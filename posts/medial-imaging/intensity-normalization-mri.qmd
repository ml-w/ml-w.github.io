---
title: "Intensity normalization - MRI"
author: "MLun Wong"
date: "2024-01-26"
categories: [DICOM, normalization, imaging, MRI, python]
format:
  html:
    toc: true
reference-location: margin
citation-location: margin
draft: true
jupyter: conda-env-data_analysis-py
---

::: callout-caution
Under construction
:::

# About MRI

Principle of MRI can be easily found on the internet, and I have also showed some simple code to simulate spin relaxation based on Bloch equation in [this post](./imaging-mri.ipynb). You should have already know that some MRI sequences do not represent intensities in an absolute scale like in CT. In this post I will cover intensity normalization of MRI for quantitative analysis.

## Weighted sequence

Weighted sequences are fundamental MRI sequences in radiology. While radiologists examine a variety of different sequences, T1w and T2w scans remain integral components of most imaging protocols. The signal intensities observed in T1/T2-weighted MRI sequences are derived from the T1 and T2 relaxation times of tissues, which are calculated by fitting the signal strength at each location over time. Consequently, these intensity values are not automatically reliable for quantitative analysis due to their generation method.

Thus, intensity normalization is a necessary step for quantitative analysis of MRI sequences (@fig-intra-scanner).

::: {#fig-intra-scanner .cell-output-display}
![MRI intra-scanner repeatability](images/paste-2.png)

Image the same salivary gland tumor scanned with two different MRI machine.
:::

::: column-margin
Extracted from my conference poster "*Reproducibility of Parotid Gland Tumor MRI Radiomic Features Across Different MRI Scanners*", AOCNR 2023, Singpore.
:::

::: callout-note
As the human eye relies on contrast rather than absolute intensity values for visual interpretation, and this contrast is consistent across different machines, this property of weighted sequences does not really affect radiologists. The requirement to normalize images was most probably raised by neuro-scientists who have extensively investigated the brain with MRI.
:::

## Quantitative sequences

Although T1- and T2-weighted images remained the most popular diagnostic sequence used by radiologist, new MRI sequences has been investigated including those that operates in a standard scales.

### Examples of quantitative sequences

-   Diffusion weighted imaging
-   Proton Density (PD)
-   Magnetic Resonance Spectroscopy (MRS)
-   Arterial Spin Labeling
-   Functional MRI

::: callout-note
While the physical factors fosters the inter-scanner reproducibility of intensity values for these sequences, environmental factors and batch effect remains and intensity normalization is still valuable.
:::

# Intensity normalization for MRI

Apart from the standard normalization techniques covered in the [previous post](./intensity-normalization-toc.qmd), there are some techniques specifically designed to normalize MRI. I will go over some of the well-established method in this post, categorized based on scan region.

## Neuro

There is a long history quantitative analysis of the brain using MRI scans. I would say with some confidence that normalization of MRI is most established for MRI brain scans. This is because the white-matter and gray-matter contrast is relatively more consistent between people when compared to other structures such as fat and muscles. Majority of the method developed for normalizing brain scan is based on white- and gray-matter contrast.

### Nyul Normalization

For this purpose I have developed a toolkit [MRI Normalization Tools (`mnts`)](https://github.com/alabamagan/mri_normalization_tools) to improve repeatability.